<div class="mt-5">
    <h3>Tìm kiếm "{{type}}"</h3>
    <hr />
    <h3>Bộ lọc sản phẩm</h3>
    <form action="/filter-products">
        <div class="input-group mb-3">
            <label class="input-group-text" for="catalogue">Danh mục</label>
            <select class="form-select" id="catalogue">
                <option selected>Tất cả</option>
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
            </select>
        </div>

        <div class="input-group mb-3">
            <label class="input-group-text" for="typeProducts">Sản phẩm</label>
            <select class="form-select" id="typeProducts">
                <option selected>Tất cả</option>
                <option value="1">Sản phẩm mới</option>
                <option value="2">Sản phẩm có ưu đãi</option>
                <option value="3">Sản phẩm phổ biến</option>
            </select>
        </div>

        <div class="input-group mb-3">
            <label class="input-group-text" for="typePrice">Giá tiền</label>
            <select class="form-select" id="typePrice">
                <option selected>Tất cả</option>
                <option value="1">Dưới 50.000₫</option>
                <option value="2">50.000 - 100.000₫</option>
                <option value="3">100.000 - 200.000₫</option>
                <option value="2">200.000 - 300.000₫</option>
                <option value="3">300.000 - 400.000₫</option>
                <option value="3">400.000 - 500.000₫</option>
                <option value="3">Trên 500.000₫</option>
            </select>
        </div>

        <div class="input-group mb-3">
            <label class="input-group-text" for="typeStars">Đánh giá</label>
            <select class="form-select" id="typeStars">
                <option selected>1 ⭐</option>
                <option>2 ⭐</option>
                <option>3 ⭐</option>
                <option>4 ⭐</option>
                <option>5 ⭐</option>
            </select>
        </div>


        <button class="btn btn-primary" type="submit">Tìm kiếm</button>
    </form>
    <div class="row row-cols-1 row-cols-md-4 g-4 mt-5">
        {{#each moreRelateProducts}}
        <div class="col" data-id="{{this.id}}" title="{{this.name}}">
            <div class="card card-home h-100">
                <img src="{{this.thumbnail}}" class="card-img-top" alt="...">
                <div class="card-body">
                    <h5 class="card-title fs-3">{{this.name}}</h5>
                    <p class="card-text">
                            <span style="width: 9rem; display: inline-block" class="text-info fs-4">{{this.newPrice}}₫</span>
                            <span class="rounded p-1 ms-2 fs-4" style="background-color: rgb(232, 72, 63); color: rgb(223, 243, 0)"><i class="fa-solid fa-fire"></i>
                                {{this.sale}}</span>
                        </p>
                        <div {{#if dark}}style="color: yellow;" class="fs-3"{{else}}class="text-danger"{{/if}}>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star-half-stroke"></i>
                            <span class="card-text text-light">({{this.numComments}})</span>
                        </div>
                        <p class="card-text mt-1 fs-5">Đã bán {{this.sold}}</p>
                </div>
            </div>
        </div>
        {{/each}}
    </div>

    {{#if onePage}}
    {{else}}
    <nav class="d-flex justify-content-center mt-4 mb-4">
        <ul class="pagination pagination-in-search">
            
        </ul>
    </nav>
    {{/if}}

</div>

<script>
    $(() => {
        function PaginationWithDot(curPage, numPage, maxPageShow) {
            const pagination = [];
            const visiblePages = Math.min(maxPageShow, numPage);

            let starPage = Math.max(1, Math.min(curPage - Math.floor(visiblePages / 2), numPage - visiblePages + 1));

            if (starPage > 1) {
                pagination.push(1);
                if (starPage > 2) {
                    pagination.push('...');
                }
            }

            for (let i = 0; i < visiblePages; i++) {
                pagination.push(starPage + i);
            }

            if (starPage + visiblePages <= numPage) {
                if (starPage + visiblePages < numPage) {
                    pagination.push('...');
                }
                pagination.push(numPage);
            }

            return pagination;
        }

        $('.col').on('click', function () {
            const product_id = $(this).data('id');
            window.location.href = `/details?id=${product_id}`;
        });

        const numPage = {{numpage}};
        const curPage = {{curpage}};
        const nameSearch = '{{type}}';
        const pagination = PaginationWithDot(curPage, numPage, 3);

        
        let pagination_append = ``;

        if (curPage === 1) {
                pagination_append += 
            `
            <li class="page-item disabled">
                <a class="page-link fs-3" aria-label="Previous"><<</a>
            </li>
            `
        } else {
            pagination_append += 
            `
            <li class="page-item">
                <a class="page-link fs-3" aria-label="Previous" href="relating-products?type=${nameSearch}&page=${curPage - 1}"><<</a>
            </li>
            `
        }
        for (let i = 0; i < pagination.length; i++) {
            let parseValue = parseInt(pagination[i]);
            if (parseValue) {
                if (parseValue === curPage) {
                    pagination_append += 
                    `
                    <li class="page-item active" aria-current="page"><a class="page-link fs-3" href="relating-products?type=${nameSearch}&page=${parseValue}">${parseValue}</a></li>
                    `
                } else {
                    pagination_append += 
                    `
                    <li class="page-item"><a class="page-link fs-3" href="relating-products?type=${nameSearch}&page=${parseValue}">${parseValue}</a></li>
                    `
                }
            } else {
                pagination_append += 
                    `
                    <li class="page-item"><a class="page-link fs-3">${pagination[i]}</a></li>
                    `
            }
        }

        if (curPage === numPage) {
            pagination_append += 
            `
            <li class="page-item disabled">
                <a class="page-link fs-3" aria-label="Next">>></a>
            </li>
            `
        } else {
            pagination_append += 
            `
            <li class="page-item">
                <a class="page-link fs-3" aria-label="Next" href="relating-products?type=${nameSearch}&page=${curPage + 1}">>></a>
            </li>
            `
        }

        $('.pagination-in-search').append(pagination_append);
    });
</script>